<div class="container mx-auto p-6">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-base-content">Create New Blog Post</h1>
    <p class="text-base-content/70 mt-2">Write and publish your next blog post</p>
  </div>

  <!-- Error Message -->
  @if (errorMessage()) {
    <div class="alert alert-error mb-6">
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>{{ errorMessage() }}</span>
    </div>
  }

  <form [formGroup]="postForm" (ngSubmit)="onSubmit()" class="space-y-8">
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title text-2xl mb-6">Post Details</h2>

        <!-- Title -->
        <div class="form-control">
          <label class="label" for="title">
            <span class="label-text font-semibold">Title *</span>
          </label>
          <input
            type="text"
            id="title"
            formControlName="title"
            class="input input-bordered w-full"
            [class.input-error]="postForm.get('title')?.invalid && postForm.get('title')?.touched"
            placeholder="Enter post title"
          />
          @if (postForm.get('title')?.invalid && postForm.get('title')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error">
                @if (postForm.get('title')?.errors?.['required']) {
                  Title is required
                }
                @if (postForm.get('title')?.errors?.['minlength']) {
                  Title must be at least 3 characters
                }
                @if (postForm.get('title')?.errors?.['maxlength']) {
                  Title must be no more than 100 characters
                }
              </span>
            </label>
          }
        </div>

        <!-- Description -->
        <div class="form-control">
          <label class="label" for="description">
            <span class="label-text font-semibold">Description *</span>
          </label>
          <textarea
            id="description"
            formControlName="description"
            rows="3"
            class="textarea textarea-bordered w-full"
            [class.textarea-error]="postForm.get('description')?.invalid && postForm.get('description')?.touched"
            placeholder="Enter post description"
          ></textarea>
          @if (postForm.get('description')?.invalid && postForm.get('description')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error">
                @if (postForm.get('description')?.errors?.['required']) {
                  Description is required
                }
                @if (postForm.get('description')?.errors?.['minlength']) {
                  Description must be at least 3 characters
                }
                @if (postForm.get('description')?.errors?.['maxlength']) {
                  Description must be no more than 1000 characters
                }
              </span>
            </label>
          }
        </div>

        <!-- Thumbnail URL -->
        <div class="form-control">
          <label class="label" for="thumbnailUrl">
            <span class="label-text font-semibold">Thumbnail URL</span>
          </label>
          <input
            type="url"
            id="thumbnailUrl"
            formControlName="thumbnailUrl"
            class="input input-bordered w-full"
            placeholder="https://example.com/image.jpg"
          />
        </div>

        <!-- Status -->
        <div class="form-control">
          <label class="label" for="status">
            <span class="label-text font-semibold">Status *</span>
          </label>
          <select
            id="status"
            formControlName="status"
            class="select select-bordered w-full"
          >
            @for (status of postStatuses; track status) {
              <option [value]="status">{{ status }}</option>
            }
          </select>
        </div>
      </div>
    </div>

    <!-- Topics -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title text-2xl mb-6">Topics</h2>
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Select Topics *</span>
          </label>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
            @for (topic of topics(); track topic.id) {
              <label class="cursor-pointer label">
                <span class="label-text">{{ topic.name }}</span>
                <input
                  type="checkbox"
                  [value]="topic.id"
                  (change)="onTopicChange(topic.id, $event.target.checked)"
                  class="checkbox checkbox-primary"
                />
              </label>
            }
          </div>
          @if (selectedTopics.length === 0 && postForm.touched) {
            <label class="label">
              <span class="label-text-alt text-error">Please select at least one topic</span>
            </label>
          }
        </div>
      </div>
    </div>

    <!-- Content Editor -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title text-2xl mb-6">Content</h2>
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Post Content *</span>
          </label>
          <app-text-editor
            (contentChange)="onContentChange($event)"
            class="border border-base-300 rounded-lg"
          ></app-text-editor>
          @if (postForm.get('content')?.invalid && postForm.get('content')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error">Content is required</span>
            </label>
          }
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <div class="flex flex-col sm:flex-row justify-end gap-4">
          <button
            type="button"
            (click)="onCancel()"
            class="btn btn-outline"
            [disabled]="isLoading()"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="isLoading() || postForm.invalid || selectedTopics.length === 0"
          >
            @if (isLoading()) {
              <span class="loading loading-spinner loading-sm"></span>
              Creating...
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              Create Post
            }
          </button>
        </div>
      </div>
    </div>
  </form>
</div>
